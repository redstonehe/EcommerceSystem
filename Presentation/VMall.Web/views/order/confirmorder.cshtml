@model VMall.Web.Models.ConfirmOrderModel
@using VMall.Web;
@{
    Layout = null;
}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>确认订单-@{@WorkContext.MallConfig.SiteTitle}</title>
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta http-equiv="content-language" content="zh-CN" />
    <meta name="copyright" content="© @WorkContext.MallConfig.SiteUrl" />
    <meta name="author" content="EMC" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <link href="@{@WorkContext.CSSCDN}/css/base.css" rel="stylesheet" type="text/css" />
    <link href="@{@WorkContext.CSSCDN}/css/home2016.css" rel="stylesheet" type="text/css" />
    <link href="@{@WorkContext.CSSCDN}/css/order.css" rel="stylesheet" type="text/css" />
    <script src="@{@WorkContext.ScriptCDN}/scripts/jquery.js" type="text/javascript"></script>
    <script type="text/javascript" src="@{@WorkContext.ScriptCDN}/scripts/utils.js"></script>
    <script type="text/javascript" src="@{@WorkContext.ScriptCDN}/scripts/order.js?v=201712_v1"></script>
    <script type="text/javascript" src="@{@WorkContext.ScriptCDN}/scripts/region.js"></script>
    <script src="@{@WorkContext.CSSCDN}/scripts/layer/layer.js" type="text/javascript"></script>
    <script type="text/javascript">
       
        isGuestSC = @WorkContext.MallConfig.IsGuestSC;
        
    </script>
</head>
<style>
    .orderSum ul li b {
        color: #E4393C;
    }

    .cashamount {
        color: #E4393C;
        width: 55px;
        display: inline-block;
    }

    .cashwarn {
        color: red;
        display: none;
        margin-left: 20px;
    }
</style>
<script>
    var isUserIdCard='@(StringHelper.ArrayContainsForNum(WebSiteConfig.QuanQiuGouStoreId, Model.SelectedStoreKeyList) ? 1 : 0)';
    var isUseExCode='@(Model.UseExCode ? 1 : 0)';
</script>
<body>

    @Html.Partial("/views/publicpage/headertop2016.cshtml")

    <div id="buyTop" class="box">
        <a href="/">
            <img src="/images/logo-65.jpg" width="280" height="65" /></a>
        <div class="buyStep">
            <ul>
                <li><s>1</s>1.我的购物车</li>
                <li class="hot"><s>2</s>2.填写核对订单信息</li>
                <li><s>3</s>3.成功提交订单</li>
                <div class="clear"></div>
            </ul>
        </div>
    </div>

    <div id="order" class="box">
        <h1>填写并核对订单信息</h1>
        <dl class="orderItme">
            <dt>收货人信息<a href="javascript:getShipAddressList()" class="shrSelectBt">[修改]</a></dt>
            <dd class="showOrder" id="shipAddressShowBlock">
                @if (Model.DefaultFullShipAddressInfo != null)
                {
                    <p>@Model.DefaultFullShipAddressInfo.Consignee @Model.DefaultFullShipAddressInfo.Mobile </p>
                    <p>@Model.DefaultFullShipAddressInfo.ProvinceName @Model.DefaultFullShipAddressInfo.CityName @Model.DefaultFullShipAddressInfo.CountyName @Model.DefaultFullShipAddressInfo.Address </p>
                }
                else
                { 
                    <text><p>
                        您还没有配送地址，请先添加。<a href="javascript:void(0)" onclick="getShipAddressList()">点击添加</a><p></text>
                }
            </dd>
            <dd class="shrSelect" id="shipAddressListBlock"></dd>
            <form name="addShipAddressForm" action="">
                <div id="addShipAddressBlock" style="display: none;">
                    <dd class="shrEdit">

                        <div class="shrCell">
                            <span><em>*</em>昵称：</span>
                            <div class="cellCon">
                                <input type="text" name="alias" value="" class="text" />
                            </div>
                        </div>

                        <div class="shrCell @*shrCellError*@">
                            <span><em>*</em>收货人：</span>
                            <div class="cellCon">
                                <input type="text" name="consignee" value="" class="text" />
                            </div>
                            @*<div class="error">请您填写收货人姓名</div>*@
                        </div>

                        <div class="shrCell">
                            <span><em>*</em>所在地区：</span>
                            <div class="cellCon">
                                <select id="provinceId" name="provinceId">
                                    <option selected="selected" value="-1">请选择</option>
                                </select>
                                <select id="cityId" name="cityId">
                                    <option selected="selected" value="-1">请选择</option>
                                </select>
                                <select id="regionId" name="regionId">
                                    <option selected="selected" value="-1">请选择</option>
                                </select>
                                @*<i>标“*”的为支持货到付款的地区,<a href="#">查看货到付款地区</a></i>*@
                            </div>
                        </div>

                        <div class="shrCell">
                            <span><em>*</em>详细地址：</span>
                            <div class="cellCon">
                                <input type="text" name="address" value="" class="text" style="width: 358px;" />
                            </div>
                        </div>

                        <div class="shrCell">
                            <span><em>*</em>手机号码：</span>
                            <div class="cellCon">
                                <input type="text" name="mobile" value="" class="text" maxlength="11" />
                                &nbsp;&nbsp;或 &nbsp;&nbsp;固定电话：<input type="text" name="phone" value="" class="text" />
                            </div>
                        </div>

                        @*<div class="shrCell">
                            <span><em></em>电子邮箱：</span>
                            <div class="cellCon">
                                <input type="text" name="email" value="" class="text" />
                                &nbsp;&nbsp;用来接收订单提醒邮件，便于您及时了解订单状态
                            </div>
                        </div>*@

                        <div class="shrCell">
                            <span><em></em>邮政编码：</span>
                            <div class="cellCon">
                                <input type="text" name="zipcode" value="" class="text" maxlength="6" />
                            </div>
                        </div>

                    </dd>
                    <dd>
                        <div class="shrBT">
                            <a href="javascript:void(0)" onclick="javascript:addShipAddress()" class="redBT">保存收货人信息</a>
                        </div>
                    </dd>
                </div>
            </form>
        </dl>

        <dl class="orderItme">
            <dt>支付方式<a href="javascript:void(0)" onclick="showPayPluginList()" class="shrSelectBt">[修改]</a></dt>
            <dd class="showOrder" id="payPluginShowBlock">
                @if (Model.DefaultPayPluginInfo != null)
                {
                    <p>@Model.DefaultPayPluginInfo.FriendlyName  @Model.DefaultPayPluginInfo.Description </p>
                }
                else
                {
                    <text><p>请选择支付方式。<a href="javascript:void(0)" onclick="showPayPluginList()">点击选择</a></p></text>
                }
            </dd>
            <dd class="zffs" id="payPluginListBlock" style="display: none;">
                <ul class="zffsList">
                    @foreach (PluginInfo info in Model.PayPluginList)
                    {
                        if (info.SystemName == "IPSpay")
                        {
                            
                        <li>
                            <label>
                                <b>
                                    <input type="radio" class="radio" name="payPluginItem" onclick="selectPayPlugin('@(info.SystemName.Trim())')" />@info.FriendlyName</b><i>@info.Description</i></label></li>
                            
                        }
                        else
                        {
                            if (info.SystemName != "IPSWXpay" && info.SystemName != "custompay")
                            {
                        <li>
                            <label>
                                <b>
                                    <input type="radio" class="radio" name="payPluginItem" onclick="selectPayPlugin('@(info.SystemName.Trim())')" />@info.FriendlyName</b><i>@info.Description</i></label></li> }
                        }

                    }
                </ul>
            </dd>
        </dl>

        <dl class="orderItme">
            <dt>
                <div class="left">商品清单</div>
                <div class="right"><a href="@Url.Action("index", "cart")">&lt;&nbsp;返回修改购物车</a></div>
                <div class="right pricewarn"><a href="javascript:void(0);"><i></i>价格说明</a>
                    <div class="price-tips">
                    <span class="Integral_box" >
                    因可能存在系统缓存、页面更新、促销活动导致价格变动异常等不确定性情况出现，商品售价以本结算页商品价格为准；如有疑问，请您返回购物车删除产品重新添加或者立即联系客服咨询。
                    </span>
                    <span class="pricewarn-arrow" style="z-index:116"></span>
                    <span class="pricewarn-close" style="z-index:116">x</span>
                        </div>
                </div>
                <div class="clear"></div>
            </dt>
            <dd style="padding-left: 0;">
                <div id="buyDT">
                    <ul>
                        <li class="checkT">&nbsp;</li>
                        <li class="productT" @(!WorkContext.IsDirSaleUser ? "style='width:500px;'" : "")>商品</li>
                        <li class="priceT">单价(元)</li>
                        @*<li class="promotionT">优惠</li>*@
                        <li class="numberT">数量</li>
                        <li class="subTotal">小计(元)</li>
                        @if (WorkContext.IsDirSaleUser)
                        {
                            <li class="numberT">PV</li>
                        }
                    </ul>
                </div>
                @foreach (StoreOrder storeOrder in Model.StoreOrderList)
                {
                    <div class="buyItme">
                        <h2 style="margin-left: 0;">
                            <label class="storeTitle">@storeOrder.StoreCartInfo.StoreInfo.Name</label></h2>
                        @if (WorkContext.IsDirSaleUser && Channel.GetProductChannelsForPids(string.Join(",", storeOrder.StoreCartInfo.SelectedOrderProductList.Select(x => x.Pid))).Distinct<int>().ToList().Exists(x => x == 1) && !Model.SelectCashPay)
                        {
                            <div class="buyItme_header">
                                <div class="info" style="width:500px"><s>促销</s>启德系统会员购买和治友德旗舰店专区产品买一送一，PV减半(不使用汇购卡支付)</div>
                                <div class="price">&nbsp;</div>
                            </div>
                        }
                        @foreach (CartItemInfo cartItemInfo in storeOrder.StoreCartInfo.CartItemList)
                        {
                            if (cartItemInfo.Type == 0)
                            {
                                CartProductInfo cartProductInfo = (CartProductInfo)cartItemInfo.Item;
                                if (cartProductInfo.Selected)
                                {
                                <div class="buyItmeC @(cartProductInfo.OrderProductInfo.ProductState >= 1 || cartProductInfo.OrderProductInfo.ProductState == -1 ? "invalid" : "")">
                                <div class="cell checkC">&nbsp;</div>
                                <div class="cell productC" @(!WorkContext.IsDirSaleUser ? "style='width:562px;'" : "")>
                                    <div class="productC1">
                                        <img src="/upload/store/@cartProductInfo.OrderProductInfo.StoreId/product/show/thumb60_60/@cartProductInfo.OrderProductInfo.ShowImg" width="50" height="50" />
                                        <a href="@Url.Action("product", "catalog", new RouteValueDictionary { { "pid", cartProductInfo.OrderProductInfo.Pid } })">@cartProductInfo.OrderProductInfo.Name
                                            @if (cartProductInfo.OrderProductInfo.SaleType == 2)
                                            { 
                                                <span style="color: red;">【保税仓发货】</span>
                                            }
                                            @if (cartProductInfo.OrderProductInfo.SaleType == 3)
                                            { 
                                                <span style="color: red;">【国际直邮】</span>
                                            }
                                        </a>
                                        <br />
                                        <span class="nosend">
                                            @{
                                            var RegionName = string.Empty;
                                            StoreShipTemplateInfo TempInfo = storeOrder.ShipTempList.Find(x => x.StoreSTid == cartProductInfo.OrderProductInfo.StoreSTid);
                                            if (TempInfo != null)
                                            {
                                                if (!string.IsNullOrEmpty(TempInfo.NoSendArea))
                                                {
                                                    RegionName = Regions.GetRegionNamesByregionids(TempInfo.NoSendArea, TempInfo.NoSendCity);
                                                }
                                            }
                                            }
                                            @if (!string.IsNullOrEmpty(RegionName) && !storeOrder.isSend)
                                            {
                                                @:(以下地区不支持发货：@RegionName)
                                                }
                                        </span>
                                        <div class="clear"></div>
                                    </div>
                                    @if (cartProductInfo.GiftList.Count > 0)
                                    {
                                        <div class="productC2">
                                            @foreach (OrderProductInfo gift in cartProductInfo.GiftList)
                                            {
                                                <p>[赠品] @gift.Name X @gift.RealCount</p>
                                            }
                                        </div>
                                    }
                                </div>
                                <div class="cell priceC">@cartProductInfo.OrderProductInfo.DiscountPrice</div>
                                @*@if (cartProductInfo.OrderProductInfo.PayCredits > 0 && cartProductInfo.OrderProductInfo.CouponTypeId == 0)
                                {
                                    <div class="priceC1 ">赠积分：<em>@cartProductInfo.OrderProductInfo.PayCredits</em></div>
                                }
                                else if (cartProductInfo.OrderProductInfo.PayCredits == 0 && cartProductInfo.OrderProductInfo.CouponTypeId > 0)
                                {
                                    <div class="priceC1 ">赠优惠劵</div>
                                }
                                else if (cartProductInfo.OrderProductInfo.PayCredits > 0 && cartProductInfo.OrderProductInfo.CouponTypeId > 0)
                                {
                                    <div class="priceC1 ">赠京豆(@cartProductInfo.OrderProductInfo.PayCredits)和优惠劵</div>
                                }
                                else
                                {
                                    <div class="nopriceC1"></div>
                                }*@
                                <div class="cell numberC">@cartProductInfo.OrderProductInfo.RealCount</div>
                                <div class="subTotalItem">@((cartProductInfo.OrderProductInfo.DiscountPrice * cartProductInfo.OrderProductInfo.BuyCount).ToString("0.00"))</div>
                                @if (WorkContext.IsDirSaleUser)
                                {
                                    <div class="subPVtotalItem">@((cartProductInfo.OrderProductInfo.PV * cartProductInfo.OrderProductInfo.BuyCount).ToString("0.00"))</div>
                                }
                                <div class="clear"></div>
                            </div>
                                }
                            }
                            else if (cartItemInfo.Type == 1)
                            {
                                CartSuitInfo cartSuitInfo = (CartSuitInfo)cartItemInfo.Item;
                                if (cartSuitInfo.Checked)
                                {
                            <div class="buyItmeC">
                                <div class="cell checkC">&nbsp;</div>
                                <div class="cell productC" @(!WorkContext.IsDirSaleUser ? "style='width:562px;'" : "")>
                                    @foreach (CartProductInfo cartProductInfo in cartSuitInfo.CartProductList)
                                    {
                                        <div class="cartSuitItem">
                                            <div class="productC1">
                                                <img src="/upload/store/@cartProductInfo.OrderProductInfo.StoreId/product/show/thumb60_60/@cartProductInfo.OrderProductInfo.ShowImg" width="50" height="50" />
                                                <a href="@Url.Action("product", "catalog", new RouteValueDictionary { { "pid", cartProductInfo.OrderProductInfo.Pid } })"><span style="color: red;">[套装]</span>@cartProductInfo.OrderProductInfo.Name</a>
                                                <br />
                                                <span class="nosend">
                                                    @{
                                        var RegionName = string.Empty;
                                        StoreShipTemplateInfo TempInfo = storeOrder.ShipTempList.Find(x => x.StoreSTid == cartProductInfo.OrderProductInfo.StoreSTid);
                                        if (TempInfo != null)
                                        {
                                            if (!string.IsNullOrEmpty(TempInfo.NoSendArea))
                                            {
                                                RegionName = Regions.GetRegionNamesByregionids(TempInfo.NoSendArea, TempInfo.NoSendCity);
                                            }
                                        }
                                                    }
                                                    @if (!string.IsNullOrEmpty(RegionName) && !storeOrder.isSend)
                                                    {
                                                        @:(以下地区不支持发货：@RegionName)
                                                }
                                                </span>
                                                <div class="clear"></div>
                                            </div>
                                            @if (cartProductInfo.GiftList.Count > 0)
                                            {
                                                <div class="productC2">
                                                    @foreach (OrderProductInfo gift in cartProductInfo.GiftList)
                                                    {
                                                        <p>[赠品] @gift.Name</p>
                                                    }
                                                </div>
                                            }
                                        </div>
                                    }
                                </div>
                                <div class="cell priceC">¥@cartSuitInfo.SuitPrice</div>
                                <div class="cell numberC">@cartSuitInfo.BuyCount</div>
                                <div class="subTotalItem">@(cartSuitInfo.SuitPrice * cartSuitInfo.BuyCount)</div>
                                @if (WorkContext.IsDirSaleUser)
                                {
                                    <div class="subPVtotalItem">@(cartSuitInfo.CartProductList.Sum(x => x.OrderProductInfo.ProductPV * x.OrderProductInfo.BuyCount).ToString("0.00"))</div>
                                }
                                <div class="clear"></div>
                            </div> 
                                }
                            }
                            else if (cartItemInfo.Type == 2)
                            {
                                CartFullSendInfo cartFullSendInfo = (CartFullSendInfo)cartItemInfo.Item;
                                if (cartFullSendInfo.FullSendMainCartProductList.Exists(x => x.Selected))
                                {
                                    if (cartFullSendInfo.FullSendMinorOrderProductInfo != null)
                                    {
                            <div class="buyItme_header">
                                <div class="info"><s>满赠</s>活动商品已购满 @cartFullSendInfo.FullSendPromotionInfo.LimitMoney 元,您已经换购了商品</div>
                            </div>
                            <div class="buyItme_header fullSendProductTitle">
                                <div class="info">[换购商品]@cartFullSendInfo.FullSendMinorOrderProductInfo.Name</div>
                            </div>
                                    }
                                    else if (cartFullSendInfo.FullSendPromotionInfo != null)
                                    {
                            <div class="buyItme_header">
                                <div class="info"><s>满赠</s>活动商品已购满 @cartFullSendInfo.FullSendPromotionInfo.LimitMoney 元,再加 @cartFullSendInfo.FullSendPromotionInfo.AddMoney 元换购</div>
                            </div>
                                    }
                                }
                                foreach (CartProductInfo cartProductInfo in cartFullSendInfo.FullSendMainCartProductList)
                                {
                                    if (cartProductInfo.Selected)
                                    {
                            <div class="buyItmeC @(cartProductInfo.OrderProductInfo.ProductState >= 1 || cartProductInfo.OrderProductInfo.ProductState == -1 ? "invalid" : "")">
                                <div class="cell checkC">&nbsp;</div>
                                <div class="cell productC" @(!WorkContext.IsDirSaleUser ? "style='width:562px;'" : "")>
                                    <div class="productC1">
                                        <img src="/upload/store/@cartProductInfo.OrderProductInfo.StoreId/product/show/thumb60_60/@cartProductInfo.OrderProductInfo.ShowImg" width="50" height="50" />
                                        <a href="@Url.Action("product", "catalog", new RouteValueDictionary { { "pid", cartProductInfo.OrderProductInfo.Pid } })">@cartProductInfo.OrderProductInfo.Name</a>
                                        <br />
                                        <span class="nosend">
                                            @{
                                        var RegionName = string.Empty;
                                        StoreShipTemplateInfo TempInfo = storeOrder.ShipTempList.Find(x => x.StoreSTid == cartProductInfo.OrderProductInfo.StoreSTid);
                                        if (TempInfo != null)
                                        {
                                            if (!string.IsNullOrEmpty(TempInfo.NoSendArea))
                                            {
                                                RegionName = Regions.GetRegionNamesByregionids(TempInfo.NoSendArea, TempInfo.NoSendCity);
                                            }
                                        }
                                            }
                                            @if (!string.IsNullOrEmpty(RegionName) && !storeOrder.isSend)
                                            {
                                                @:(以下地区不支持发货：@RegionName)
                                                }
                                        </span>
                                        <div class="clear"></div>
                                    </div>
                                    @if (cartProductInfo.GiftList.Count > 0)
                                    {
                                        <div class="productC2">
                                            @foreach (OrderProductInfo gift in cartProductInfo.GiftList)
                                            {
                                                <p>[赠品] @gift.Name</p>
                                            }
                                        </div>
                                    }
                                </div>
                                <div class="cell priceC">¥@cartProductInfo.OrderProductInfo.DiscountPrice</div>
                                @*@if (cartProductInfo.OrderProductInfo.PayCredits > 0 && cartProductInfo.OrderProductInfo.CouponTypeId == 0)
                                {
                                    <div class="priceC1 ">赠积分：<em>@cartProductInfo.OrderProductInfo.PayCredits</em></div>
                                }
                                else if (cartProductInfo.OrderProductInfo.PayCredits == 0 && cartProductInfo.OrderProductInfo.CouponTypeId > 0)
                                {
                                    <div class="priceC1 ">赠优惠劵</div>
                                }
                                else if (cartProductInfo.OrderProductInfo.PayCredits > 0 && cartProductInfo.OrderProductInfo.CouponTypeId > 0)
                                {
                                    <div class="priceC1 ">赠京豆(@cartProductInfo.OrderProductInfo.PayCredits)和优惠劵</div>
                                }
                                else
                                {
                                    <div class="nopriceC1"></div> 
                                }*@
                                <div class="cell numberC">@cartProductInfo.OrderProductInfo.RealCount</div>
                                <div class="subTotalItem">@((cartProductInfo.OrderProductInfo.DiscountPrice * cartProductInfo.OrderProductInfo.BuyCount).ToString("0.00"))</div>
                                @if (WorkContext.IsDirSaleUser)
                                {
                                    <div class="subPVtotalItem">@((cartProductInfo.OrderProductInfo.PV * cartProductInfo.OrderProductInfo.BuyCount).ToString("0.00"))</div>
                                }
                                <div class="clear"></div>
                            </div> 
                                    }
                                }
                            }
                            else if (cartItemInfo.Type == 3)
                            {
                                CartFullCutInfo cartFullCutInfo = (CartFullCutInfo)cartItemInfo.Item;
                                if (cartFullCutInfo.FullCutCartProductList.Exists(x => x.Selected))
                                {
                                    if (cartFullCutInfo.IsEnough)
                                    {
                            <div class="buyItme_header">
                                <div class="info"><s>满减</s>活动商品已购满 @cartFullCutInfo.LimitMoney 元,优惠 @cartFullCutInfo.CutMoney 元</div>
                                <div class="price">&nbsp;</div>
                                <s>满减：¥@cartFullCutInfo.CutMoney</s>
                            </div>
                                    }
                                    else
                                    {
                            <div class="buyItme_header">
                                <div class="info"><s>满减</s>活动商品购满 @cartFullCutInfo.LimitMoney 元,即可享受满减 @cartFullCutInfo.CutMoney 元</div>
                            </div>
                                    }
                                }
                                foreach (CartProductInfo cartProductInfo in cartFullCutInfo.FullCutCartProductList)
                                {
                                    if (cartProductInfo.Selected)
                                    {
                            <div class="buyItmeC @(cartProductInfo.OrderProductInfo.ProductState >= 1 || cartProductInfo.OrderProductInfo.ProductState == -1 ? "invalid" : "")">
                                <div class="cell checkC">&nbsp;</div>
                                <div class="cell productC" @(!WorkContext.IsDirSaleUser ? "style='width:562px;'" : "")>
                                    <div class="productC1">
                                        <img src="/upload/store/@cartProductInfo.OrderProductInfo.StoreId/product/show/thumb60_60/@cartProductInfo.OrderProductInfo.ShowImg" width="50" height="50" />
                                        <a href="@Url.Action("product", "catalog", new RouteValueDictionary { { "pid", cartProductInfo.OrderProductInfo.Pid } })">@cartProductInfo.OrderProductInfo.Name</a>
                                        <br />
                                        <span class="nosend">
                                            @{
                                        var RegionName = string.Empty;
                                        StoreShipTemplateInfo TempInfo = storeOrder.ShipTempList.Find(x => x.StoreSTid == cartProductInfo.OrderProductInfo.StoreSTid);
                                        if (TempInfo != null)
                                        {
                                            if (!string.IsNullOrEmpty(TempInfo.NoSendArea))
                                            {
                                                RegionName = Regions.GetRegionNamesByregionids(TempInfo.NoSendArea, TempInfo.NoSendCity);
                                            }
                                        }
                                            }
                                            @if (!string.IsNullOrEmpty(RegionName) && !storeOrder.isSend)
                                            {
                                                @:(以下地区不支持发货：@RegionName)
                                                }
                                        </span>
                                        <div class="clear"></div>
                                    </div>
                                    @if (cartProductInfo.GiftList.Count > 0)
                                    {
                                        <div class="productC2">
                                            @foreach (OrderProductInfo gift in cartProductInfo.GiftList)
                                            {
                                                <p>[赠品] @gift.Name</p>
                                            }
                                        </div>
                                    }
                                </div>
                                <div class="cell priceC">¥@cartProductInfo.OrderProductInfo.DiscountPrice</div>
                                @*@if (cartProductInfo.OrderProductInfo.PayCredits > 0 && cartProductInfo.OrderProductInfo.CouponTypeId == 0)
                                {
                                    <div class="priceC1 ">赠积分：<em>@cartProductInfo.OrderProductInfo.PayCredits</em></div>
                                }
                                else if (cartProductInfo.OrderProductInfo.PayCredits == 0 && cartProductInfo.OrderProductInfo.CouponTypeId > 0)
                                {
                                    <div class="priceC1 ">赠优惠劵</div>
                                }
                                else if (cartProductInfo.OrderProductInfo.PayCredits > 0 && cartProductInfo.OrderProductInfo.CouponTypeId > 0)
                                {
                                    <div class="priceC1 ">赠京豆(@cartProductInfo.OrderProductInfo.PayCredits)和优惠劵</div>
                                }
                                else
                                {
                                    <div class="nopriceC1"></div> 
                                }*@
                                <div class="cell numberC">@cartProductInfo.OrderProductInfo.RealCount</div>
                                <div class="subTotalItem">@((cartProductInfo.OrderProductInfo.DiscountPrice * cartProductInfo.OrderProductInfo.BuyCount).ToString("0.00"))</div>
                                @if (WorkContext.IsDirSaleUser)
                                {
                                    <div class="subPVtotalItem">@((cartProductInfo.OrderProductInfo.PV * cartProductInfo.OrderProductInfo.BuyCount).ToString("0.00"))</div>
                                }
                                <div class="clear"></div>
                            </div> 
                                    }
                                }
                            }
                        }
                    </div>
                    
                    <div class="subSum f12">
                        <p class="left"></p>
                        <p class="right"><span>商品合计：<i class="hg_red f16 hg_yahei">@storeOrder.ProductAmount</i></span></p>
                        <p class="right"><span>运费：<i class="hg_yahei" id="fare_1_1">@storeOrder.ShipFee.ToString("0.00")</i></span></p>
                        @*
                        <p class="right"><span>可用红包减免：<i class="hg_yahei">-@Carts.SumOrderProductHongBaoCutAmount(storeOrder.StoreCartInfo.SelectedOrderProductList)</i></span></p>*@
                        @*<p class="right"><span>优惠：<i class="hg_yahei">-@Carts.SumOrderProductDiscount(storeOrder.StoreCartInfo.SelectedOrderProductList)</i></span></p>*@
                    </div>
                }
                <div style="border-top: 1px solid #ddd;"></div>
            </dd>

            <dd style="padding: 0;"></dd>
        </dl>

        <div class="orderSum1 borDDD" style="border-top: 0;">


            <div class="itme">
                <h3><a href="javascript:;" onclick="openCoupon(this)">使用优惠券</a></h3>
                <div class="sumCon" id="couponBlock">
                    <ul class="tag">
                        <li><a href="javascript:;">可用优惠卷（<em id="validCouponCount">0</em>）</a></li>
                    </ul>
                    <div class="itmeCon" id="validCouponList">
                        @*<p>有优惠券兑换码？ <a href="#">[点击输入兑换码]</a></p>
                        <p>共使用了 <font color="red">0</font> 张优惠券　可以优惠<font color="red">0.00</font> 元</p>*@
                    </div>
                </div>
                <script type="text/javascript">
                    function openCoupon(obj) {
                        if (obj.className == "down") {
                            obj.className = "";
                            document.getElementById("couponBlock").style.display = "none";
                        }
                        else {
                            obj.className = "down";
                            document.getElementById("couponBlock").style.display = "block";
                            getValidCouponList();
                        }
                    }
                    function useCoupon(obj){
                        var checkboxList = document.getElementById("validCouponList").getElementsByTagName("input");
                        for (var i = 0; i < checkboxList.length; i++) {
                            checkboxList[i].checked = false;
                        }
                        obj.checked = true;
                        var selectCoupon=$("input[name='couponId']:checked");
                        var couponMoney=selectCoupon.attr("data-money");
                        //alert(couponMoney);
                        var daiLiCount=($("#daiLiCount").length>0?$("#daiLiCount").val():0);
                        var YongJinCount=($("#YongJinCount").length>0?$("#YongJinCount").val():0);
                        var hongBaoCount=($("#hongBaoCount").length>0?$("#hongBaoCount").val():0);
                        var haiMiCount=($("#haiMiCount").length>0?$("#haiMiCount").val():0);
                        var CashCount=($("#CashCount").length>0?$("#CashCount").val():0);
                        if ((@Model.AllOrderAmount -couponMoney - haiMiCount-hongBaoCount-CashCount-daiLiCount-YongJinCount) < 0) {
                            obj.checked = false;
                            alert("优惠抵扣总金额不能大于订单金额");
                            return;
                        }
                        $("#couponmoney").html("-"+couponMoney);
                        $("#totalmoney").html("¥"+(@Model.AllOrderAmount-couponMoney-haiMiCount-hongBaoCount-CashCount-daiLiCount-YongJinCount).toFixed(2));
                    }
                </script>
            </div>

            <div class="itme">
                <h3><a href="javascript:;" onclick="openHaiMi(this)">使用@(MallKey.MallDiscountName_JiangJin)</a></h3>
                <div class="sumCon" id="haiMiSumCon">
                    <div class="itmeCon">
                        @{var userHaimi = 0M;
                          AccountInfo haiMiAccount = Model.UserAccountInfo.Find(x => x.AccountId == (int)AccountType.商城钱包);
                          if (haiMiAccount != null)
                          {
                              userHaimi = System.Math.Round(haiMiAccount.Banlance, 2);
                          }
                        }
                        <p>
                            本次使用
                            <input type="text" class="text" size="10" id="haiMiCount" name="haiMiCount" value="0" onblur="checkHaiMi(@userHaimi,@Model.AllOrderAmount)" />
                            @(MallKey.MallDiscountName_JiangJin)
                        </p>
                        <p>
                            您拥有@(MallKey.MallDiscountName_JiangJin)：<strong style="color: #f00;">@userHaimi</strong>
                        </p>
                    </div>
                </div>
                <script type="text/javascript">
                    function openHaiMi(obj) {
                        if (obj.className == "down") {
                            obj.className = "";
                            document.getElementById("haiMiSumCon").style.display = "none";
                        }
                        else {
                            obj.className = "down";
                            document.getElementById("haiMiSumCon").style.display = "block";
                        }
                    }
                    function checkHaiMi(hasPayCreditCount,maxUsePayCreditCount) {
                        var obj = $("#haiMiCount");
                        var usePayCreditCount = obj.val();
                        var daiLiCount=($("#daiLiCount").length>0?$("#daiLiCount").val():0);
                        var YongJinCount=($("#YongJinCount").length>0?$("#YongJinCount").val():0);
                        var hongBaoCount=($("#hongBaoCount").length>0?$("#hongBaoCount").val():0);
                        var CashCount=($("#CashCount").length>0?$("#CashCount").val():0);
                        var couponMoney=($("input[name='couponId']:checked").length>0?$("input[name='couponId']:checked").attr("data-money"):0);
                        if (isNaN(usePayCreditCount)) {
                            obj.val(0);
                            alert("请输入数字");
                        }
                        else if(usePayCreditCount<0){
                            obj.val(0);
                            alert("不能输入负数");
                        }
                        else if (usePayCreditCount > hasPayCreditCount) {
                            obj.val( hasPayCreditCount);
                            alert("金额不足,最多可用数" + hasPayCreditCount + "");
                        }
                        else if (usePayCreditCount > maxUsePayCreditCount) {
                            obj.val(maxUsePayCreditCount);
                            alert("该订单最多可用数" + maxUsePayCreditCount);
                        }
                        if ((@Model.AllOrderAmount -obj.val() - CashCount-hongBaoCount-couponMoney-daiLiCount-YongJinCount ) < 0) {
                            obj.val(0);
                            alert("优惠抵扣总金额不能大于订单金额");
                            $("#haiMiCount").focus();
                            return;
                        }
                        $("#savemoney").html("¥"+obj.val());
                        $("#totalmoney").html("¥"+(@Model.AllOrderAmount-obj.val()-CashCount-hongBaoCount-couponMoney-daiLiCount-YongJinCount).toFixed(2));
                    }
                </script>
            </div>
            @if (Model.isUserAgentDiscount)
            {
                <div class="itme">
                    <h3><a href="javascript:;" onclick="openDaiLi(this)">使用代理账户支付</a></h3>
                    <div class="sumCon" id="daiLiSumCon">
                        <div class="itmeCon">
                            @{var userDaiLi = 0M;
                              AccountInfo daiLiAccount = Model.UserAccountInfo.Find(x => x.AccountId == (int)AccountType.代理账户);
                              if (daiLiAccount != null)
                              {
                                  userDaiLi = System.Math.Round(daiLiAccount.Banlance, 2);
                              }
                            }
                            <p>
                                本次使用
                            <input type="text" class="text" size="10" id="daiLiCount" name="daiLiCount" value="0" onblur="checkDaiLi(@userDaiLi,@Model.AllOrderAmount)" />
                                @*,当前订单可用代理账户余额：<strong style="color: #005ea7;">@Model.AllOrderAmount</strong>*@
                            </p>
                            <p>
                                您代理账户余额：<strong style="color: #f00;">@userDaiLi</strong>
                            </p>
                        </div>
                    </div>
                    <script type="text/javascript">
                        function openDaiLi(obj) {
                            if (obj.className == "down") {
                                obj.className = "";
                                document.getElementById("daiLiSumCon").style.display = "none";
                            }
                            else {
                                obj.className = "down";
                                document.getElementById("daiLiSumCon").style.display = "block";
                            }
                        }
                        function checkDaiLi(hasPayCreditCount,maxUsePayCreditCount) {
                            var obj = $("#daiLiCount");
                            var usePayCreditCount = obj.val();
                            var haiMiCount=($("#haiMiCount").length>0?$("#haiMiCount").val():0);
                            var YongJinCount=($("#YongJinCount").length>0?$("#YongJinCount").val():0);
                            var hongBaoCount=($("#hongBaoCount").length>0?$("#hongBaoCount").val():0);
                            var CashCount=($("#CashCount").length>0?$("#CashCount").val():0);
                            var couponMoney=($("input[name='couponId']:checked").length>0?$("input[name='couponId']:checked").attr("data-money"):0);
                            if (isNaN(usePayCreditCount)) {
                                obj.val(0);
                                alert("请输入数字");
                            }
                            else if(usePayCreditCount<0){
                                obj.val(0);
                                alert("不能输入负数");
                            }
                            else if (usePayCreditCount > hasPayCreditCount) {
                                obj.val( hasPayCreditCount);
                                alert("金额不足,最多可用" + hasPayCreditCount + "");
                            }
                            else if (usePayCreditCount > maxUsePayCreditCount) {
                                obj.val(maxUsePayCreditCount);
                                alert("该订单最多可用" + maxUsePayCreditCount);
                            }
                            if ((@Model.AllOrderAmount -obj.val() - CashCount-hongBaoCount-couponMoney-haiMiCount-YongJinCount ) < 0) {
                                obj.val(0);
                                alert("抵扣总金额不能大于订单金额");
                                $("#daiLiCount").focus();
                                return;
                            }
                            $("#agentCut").html("¥"+obj.val());
                            $("#totalmoney").html("¥"+(@Model.AllOrderAmount-obj.val()-CashCount-hongBaoCount-couponMoney-haiMiCount-YongJinCount).toFixed(2));
                        }
                    </script>
                </div>
            }
            @if (Model.isUserCommisionDiscount)
            {
                <div class="itme">
                    <h3><a href="javascript:;" onclick="openYongJin(this)">使用佣金账户支付</a></h3>
                    <div class="sumCon" id="YongJinSumCon">
                        <div class="itmeCon">
                            @{var userYongJin = 0M;
                              AccountInfo YongJinAccount = Model.UserAccountInfo.Find(x => x.AccountId == (int)AccountType.佣金账户);
                              if (YongJinAccount != null)
                              {
                                  userYongJin = System.Math.Round(YongJinAccount.Banlance, 2);
                              }
                            }
                            <p>
                                本次使用
                            <input type="text" class="text" size="10" id="YongJinCount" name="YongJinCount" value="0" onblur="checkYongJin(@userYongJin,@Model.AllOrderAmount)" />
                                @*,当前订单可用佣金账户余额：<strong style="color: #005ea7;">@Model.AllOrderAmount</strong>*@
                            </p>
                            <p>
                                您佣金账户余额：<strong style="color: #f00;">@userYongJin</strong>
                            </p>
                        </div>
                    </div>
                    <script type="text/javascript">
                        function openYongJin(obj) {
                            if (obj.className == "down") {
                                obj.className = "";
                                document.getElementById("YongJinSumCon").style.display = "none";
                            }
                            else {
                                obj.className = "down";
                                document.getElementById("YongJinSumCon").style.display = "block";
                            }
                        }
                        function checkYongJin(hasPayCreditCount,maxUsePayCreditCount) {
                            var obj = $("#YongJinCount");
                            var usePayCreditCount = obj.val();
                            var haiMiCount=($("#haiMiCount").length>0?$("#haiMiCount").val():0);
                            var daiLiCount=($("#daiLiCount").length>0?$("#daiLiCount").val():0);
                            var hongBaoCount=($("#hongBaoCount").length>0?$("#hongBaoCount").val():0);
                            var CashCount=($("#CashCount").length>0?$("#CashCount").val():0);
                            var couponMoney=($("input[name='couponId']:checked").length>0?$("input[name='couponId']:checked").attr("data-money"):0);
                            if (isNaN(usePayCreditCount)) {
                                obj.val(0);
                                alert("请输入数字");
                            }
                            else if(usePayCreditCount<0){
                                obj.val(0);
                                alert("不能输入负数");
                            }
                            else if (usePayCreditCount > hasPayCreditCount) {
                                obj.val( hasPayCreditCount);
                                alert("金额不足,最多可用" + hasPayCreditCount + "");
                            }
                            else if (usePayCreditCount > maxUsePayCreditCount) {
                                obj.val(maxUsePayCreditCount);
                                alert("该订单最多可用" + maxUsePayCreditCount);
                            }
                            if ((@Model.AllOrderAmount -obj.val() - CashCount-hongBaoCount-couponMoney-haiMiCount- daiLiCount) < 0) {
                                obj.val(0);
                                alert("抵扣总金额不能大于订单金额");
                                $("#YongJinCount").focus();
                                return;
                            }
                            $("#commisionCut").html("¥"+obj.val());
                            $("#totalmoney").html("¥"+(@Model.AllOrderAmount-obj.val()-CashCount-hongBaoCount-couponMoney-haiMiCount- daiLiCount).toFixed(2));
                        }
                    </script>
                </div>
            }
            @{var userHongBao2 = 0M;
              AccountInfo hongBaoAccount = Model.UserAccountInfo.Find(x => x.AccountId == 9);
              if (hongBaoAccount != null)
              {
                  userHongBao2 = System.Math.Round(hongBaoAccount.Banlance, 2);
              }
            }
            @if (Model.AllHonBaoCutFee > 0)
            {
                <div class="itme">
                    <h3><a href="javascript:;" class="down" @*onclick="openHongBao(this)"*@>使用红包</a></h3>
                    <div class="sumCon" id="hongBaoSumCon" style="display: block;">
                        <div class="itmeCon">

                            <p>
                                本次使用
                            <input type="text" class="text" size="10" id="hongBaoCount" name="hongBaoCount" value="@(userHongBao2 > Model.AllHonBaoCutFee ? Model.AllHonBaoCutFee : userHongBao2)" onblur="checkHongBao(@userHongBao2,@Model.AllHonBaoCutFee)" />
                                红包
                            </p>
                            <p>
                                您拥有红包：<strong style="color: red;">@userHongBao2</strong>，当前订单可用红包：<strong style="color: #005ea7;">@Model.AllHonBaoCutFee</strong>
                            </p>
                        </div>
                    </div>
                    <script type="text/javascript">
                        //function openHongBao(obj) {
                        //    if (obj.className == "down") {
                        //        obj.className = "";
                        //        document.getElementById("hongBaoSumCon").style.display = "none";
                        //    }
                        //    else {
                        //        obj.className = "down";
                        //        document.getElementById("hongBaoSumCon").style.display = "block";
                        //    }
                        //}
                    
                        function checkHongBao(hasHongBaoCount,maxUseHongBaoCount) {
                            var obj = $("#hongBaoCount");
                            var useHongBaoCount = obj.val();
                            var daiLiCount=($("#daiLiCount").length>0?$("#daiLiCount").val():0);
                            var YongJinCount=($("#YongJinCount").length>0?$("#YongJinCount").val():0);
                            var CashCount=($("#CashCount").length>0?$("#CashCount").val():0);
                            var haiMiCount=($("#haiMiCount").length>0?$("#haiMiCount").val():0);
                            var couponMoney=($("input[name='couponId']:checked").length>0?$("input[name='couponId']:checked").attr("data-money"):0);
                            if (isNaN(useHongBaoCount)) {
                                obj.val(0);
                                alert("请输入数字");
                            }
                            else if(useHongBaoCount<0){
                                obj.val(0);
                                alert("不能输入负数");
                            }
                            else if (useHongBaoCount > hasHongBaoCount) {
                                obj.val(hasHongBaoCount);
                                alert("红包不足");
                            }
                            else if (useHongBaoCount > maxUseHongBaoCount) {
                                obj.val(maxUseHongBaoCount);
                                alert("最多只能使用" + maxUseHongBaoCount + "个");
                            }
                            if ((@Model.AllOrderAmount -obj.val() - CashCount-haiMiCount-couponMoney-daiLiCount-YongJinCount) < 0) {
                                obj.val(0);
                                alert("优惠抵扣总金额不能大于订单金额");
                                $("#hongBaoCount").focus();
                                return;
                            }
                            $("#hongbaocut").html("-¥"+obj.val());
                            $("#totalmoney").html("¥"+(@Model.AllOrderAmount-obj.val()-CashCount-haiMiCount-couponMoney-daiLiCount-YongJinCount).toFixed(2));
                        }

                    </script>
                </div>
            }
            <div class="itme">
                <h3><a href="javascript:;" onclick="openBuyerRemark(this)">添加订单备注</a></h3>
                <div class="sumCon" id="buyerRemarkSumCon">
                    <div class="itmeCon">
                        <p>
                            <input type="text" name="buyerRemark" id="buyerRemark" class="text" style="width: 890px;" value="" />
                        </p>
                        <p>提示：请勿填写与支付、发票、收货方面的信息</p>
                    </div>
                </div>
                <script type="text/javascript">
                    function openBuyerRemark(obj) {
                        if (obj.className == "down") {
                            obj.className = "";
                            document.getElementById("buyerRemarkSumCon").style.display = "none";
                        }
                        else {
                            obj.className = "down";
                            document.getElementById("buyerRemarkSumCon").style.display = "block";
                        }
                    }
                    $(function () {
                        $("#alertInfo_box").hover(function () {
                            $(".alertInfo").show();
                        }, function () {
                            $(".alertInfo").hide();
                        })
                    })
                    $(function(){
                        $(".invoice-body").removeClass("invoice-item-selected");
                        $(".invoice-id-p,.invoice-regaddr-p,.invoice-regmobile-p,.invoice-bank-p,.invoice-bankno-p").hide();
                    })
                    function selectinvoicetype(type){
                        $(".invoice-type").removeClass("invoice-item-selected");
                        if(type==0){
                            $(".ul-body").show();
                            $(".invoice-type").eq(0).addClass("invoice-item-selected");
                        }
                        else if(type==1){
                            $(".ul-body").show();
                            $(".invoice-type").eq(1).addClass("invoice-item-selected");
                            $(".invoice-body").removeClass("invoice-item-selected");
                            $(".invoice-body").eq(1).addClass("invoice-item-selected"); 
                            $(".invoice-id-p,.invoice-regaddr-p,.invoice-regmobile-p,.invoice-bank-p,.invoice-bankno-p").show();
                        }
                        else{
                            //$(".ul-body").hide();
                            $(".invoice-type").eq(2).addClass("invoice-item-selected");
                            $(".invoice-body").removeClass("invoice-item-selected");
                            //$(".invoice-title-p,.invoice-id-p,.invoice-regaddr-p,.invoice-regmobile-p,.invoice-bank-p,.invoice-bankno-p").hide();
                            $(".invoice-title,.invoice-id,.invoice-regaddr,.invoice-regmobile,.invoice-bank,.invoice-bankno").val("");
                        }
                    }
                    function selectinvoicebody(type){
                        var invoicetype=$(".ul-type .invoice-item-selected").val();
                        if(type==0){
                            if(invoicetype==0){
                                $(".invoice-body").removeClass("invoice-item-selected");
                                $(".invoice-body").eq(0).addClass("invoice-item-selected");
                                $(".invoice-id-p,.invoice-regaddr-p,.invoice-regmobile-p,.invoice-bank-p,.invoice-bankno-p").hide();
                                $(".invoice-id,.invoice-regaddr,.invoice-regmobile,.invoice-bank,.invoice-bankno").val("");
                            }else if(invoicetype==1){
                                alert("增值税专用发票不支持个人开票");
                            }
                        }
                        else if(type==1){
                            if(invoicetype==0||invoicetype==1){
                                $(".invoice-body").removeClass("invoice-item-selected");
                                $(".invoice-body").eq(1).addClass("invoice-item-selected");
                                $(".invoice-id-p,.invoice-regaddr-p,.invoice-regmobile-p,.invoice-bank-p,.invoice-bankno-p").show();
                            }
                        }
                    }
                </script>
            </div>
            <div class="itme">
                <h3><a href="javascript:;" onclick="openInvoice(this)">需要发票</a></h3>
                <div class="sumCon" id="invoiceSumCon">
                    <div class="itmeCon">
                        <div class="invoice-list">
                            <ul class="ul-type">
                                <li class="invoice-name">发票类型：</li>
                                <li class="invoice-item  invoice-type"  value="0" onclick="selectinvoicetype(0)">普通发票<b></b></li>
                                <li class="invoice-item invoice-type" value="1" onclick="selectinvoicetype(1)">增值税专用发票<b></b>
                                <li class="invoice-item invoice-item-selected  invoice-type"  value="2" onclick="selectinvoicetype(2)">不开发票<b></b></li>
                                <li class="clear"></li>
                            </ul>
                        </div>
                        <div class="invoice-list">
                            <ul class="ul-body">
                                <li class="invoice-name">发票主体：</li>
                                <li class="invoice-item invoice-item-selected invoice-body" value="0" onclick="selectinvoicebody(0)">个人<b></b> </li>
                                <li class="invoice-item invoice-body" value="1" onclick="selectinvoicebody(1)">单位发票<b></b></li>
                                <li class="clear"></li>
                            </ul>
                        </div>
                        <p class="invoice-title-p">
                            <span class="invoice-detail" >发票抬头：</span>
                            <input type="text" name="invoice-title" id="invoice-title" class="text invoice-input invoice-title"  value="" />
                        </p>
                        <p class="invoice-id-p">
                            <span class="invoice-detail" >纳税人识别号：</span>
                            <input type="text" name="invoice-id" id="invoice-id" class="text invoice-input invoice-id"  value="" />
                        </p>
                        <p class="invoice-regaddr-p"> 
                            <span class="invoice-detail" >注册地址：</span>
                            <input type="text" name="invoice-regaddr" id="invoice-regaddr" class="text invoice-input invoice-regaddr"  value="" />
                        </p>
                        <p class="invoice-regmobile-p">
                            <span class="invoice-detail" >注册电话：</span>
                            <input type="text" name="invoice-regmobile" id="invoice-regmobile" class="text invoice-input invoice-regmobile"  value="" maxlength="11"/>
                        </p>
                        <p class="invoice-bank-p">
                            <span class="invoice-detail" >开户银行：</span>
                            <input type="text" name="invoice-bank" id="invoice-bank" class="text invoice-input invoice-bank" value="" />
                        </p>
                        <p class="invoice-bankno-p">
                            <span class="invoice-detail" >银行帐号：</span>
                            <input type="text" name="invoice-bankno" id="invoice-bankno" class="text invoice-input invoice-bankno" value="" />
                        </p>
                        <p class="invoice_warn">提示：1.如须开具发票请填写正确的发票信息。
                <br />2.全球购专区产品及其他专区某些特定产品不支持开发票。</p>
                    </div>
                </div>
                <script type="text/javascript">
                    function openInvoice(obj) {
                        if (obj.className == "down") {
                            obj.className = "";
                            document.getElementById("invoiceSumCon").style.display = "none";
                        }
                        else {
                            obj.className = "down";
                            document.getElementById("invoiceSumCon").style.display = "block";
                        }
                    }

                    $(function () {
                        $("#alertInfo_box").hover(function () {
                            $(".alertInfo").show();
                        }, function () {
                            $(".alertInfo").hide();
                        })
                        $(".pricewarn").toggle(function () {
                            $(".price-tips").show();
                           
                        }, function () {
                            $(".price-tips").hide();
                        })
                        $("#pricewarn-close").click(function () {
                            $(".price-tips").hide();
                        })
                    })

                </script>
            </div>
            @if (Model.isUserCsahCoupon)
            {
                <div class="itme">
                    <h3>
                        <input id="cashcouponCard" type="checkbox" class="paytype-cash" onclick="userCash(this)" @(Model.SelectCashPay ? "checked=checked" : "")/>
                        <span style="color: #005ea7;">使用汇购卡<span style="margin-left: 20px; color: #808080;">(可用汇购卡 <b style="color: red;">@Model.CashCouponList.Count</b> 张) </span>
                        </span>
                        <span  class="cashwarn" style="@(Model.SelectCashPay ? "display: block" : "display: none")">* 汇购卡支付不结算PV，汇购卡支付不支持特价产品
                        </span>
                    </h3>
                    <div class="sumCon" id="CashSumCon" style="@(Model.SelectCashPay ? "display: block" : "display: none")">
                        <div class="itmeCon">
                            <ul>
                                @foreach (var item in Model.CashCouponList)
                                {
                                    <li>
                                        <input type="checkbox" value="@item.CashId" name="cashId" />&nbsp;&nbsp;
                                @item.CashCouponSN &nbsp;&nbsp;&nbsp;&nbsp;
                                可用余额：<span class="cashamount">@item.Banlance</span> &nbsp;&nbsp;&nbsp;&nbsp;
                                有效期：@item.ValidTime.ToString("yyyy-MM-dd HH:mm")
                                    </li>
                                }
                            </ul>
                            <p>
                                本次使用：<input type="text" class="text" size="10" id="CashCount" name="CashCount" value="0" onblur="checkCash(@Model.AvailCashCouponAmount)" />
                                汇购卡券，当前订单可用汇购卡券：<strong style="color: #005ea7;">@Model.AvailCashCouponAmount</strong>
                            </p>
                            <p>支付密码：<input type="password" class="text" size="10" id="paypassword" name="paypassword" value="" /></p>
                        </div>
                    </div>
                    <script type="text/javascript">
                        function userCash(obj){
                            if($(obj).is(':checked')){
                                selectCashPay(1);
                                $("#CashSumCon").show();
                                $(".cashwarn").show();
                            }else{
                                selectCashPay(0);
                                var daiLiCount=($("#daiLiCount").length>0?$("#daiLiCount").val():0);
                                var YongJinCount=($("#YongJinCount").length>0?$("#YongJinCount").val():0);
                                var hongBaoCount=($("#hongBaoCount").length>0?$("#hongBaoCount").val():0);
                                var haiMiCount=($("#haiMiCount").length>0?$("#haiMiCount").val():0);
                                var couponMoney=($("input[name='couponId']:checked").length>0?$("input[name='couponId']:checked").attr("data-money"):0);
                                $("#CashCount").val(0);
                                $("input[name='cashId']").attr("checked",false);
                                $("#cashmoney").html("¥-0.00");
                                $("#totalmoney").html("¥"+(@Model.AllOrderAmount-haiMiCount-hongBaoCount-couponMoney-daiLiCount-YongJinCount).toFixed(2));
                                $("#CashSumCon").hide();
                                $(".cashwarn").hide();
                            }
                        }

                        function checkCash(maxUseCashCount) {
                            var hasCashCount=0;//parseFloat($("input[name='cashId']:checked").next().html());
                            var selectCash=$("input[name='cashId']:checked");
                            var selectTotalCashCount=0;
                            for (var i = 0; i < selectCash.length; i++) {
                                if (selectCash[i].checked == true) {
                                    selectTotalCashCount += parseFloat($($("input[name='cashId']:checked")[i]).next().html());
                                }
                            }
                            hasCashCount=selectTotalCashCount;
                            //alert(hasCashCount);
                            var obj = $("#CashCount");
                            var useCashCount =parseFloat(obj.val());
                            var daiLiCount=($("#daiLiCount").length>0?$("#daiLiCount").val():0);
                            var YongJinCount=($("#YongJinCount").length>0?$("#YongJinCount").val():0);
                            var hongBaoCount=($("#hongBaoCount").length>0?$("#hongBaoCount").val():0);
                            var haiMiCount=($("#haiMiCount").length>0?$("#haiMiCount").val():0);
                            var couponMoney=($("input[name='couponId']:checked").length>0?$("input[name='couponId']:checked").attr("data-money"):0);
                            if (isNaN(useCashCount)) {
                                obj.val(0);
                                alert("请输入数字");
                            }
                            else if(useCashCount<0){
                                obj.val(0);
                                alert("不能输入负数");
                            }
                            else if (useCashCount > hasCashCount ) {
                                obj.val( hasCashCount);
                                alert("金额不足,最多可用数" + hasCashCount + "");
                            }
                            else if (useCashCount > maxUseCashCount) {
                                obj.val(maxUseCashCount);
                                alert("该订单最多可用数" + maxUseCashCount);
                            }
                            if ((@Model.AllOrderAmount -obj.val() - haiMiCount-hongBaoCount-couponMoney-daiLiCount-YongJinCount) < 0) {
                                obj.val(0);
                                alert("优惠抵扣总金额不能大于订单金额");
                                $("#CashCount").focus();
                                return;
                            }
                            $("#cashmoney").html("¥-"+obj.val());
                            $("#totalmoney").html("¥"+(@Model.AllOrderAmount-obj.val()-haiMiCount-hongBaoCount-couponMoney-daiLiCount-YongJinCount).toFixed(2));
                        }
                    </script>
                </div>
            }
            @if (Model.UseExCode)
            {
                <div class="itme">
                    <h3><a href="javascript:;" class="down">使用兑换码</a></h3>
                    <div class="" id="excouponBlock">
                        <div class="itmeCon" id="">
                            <ul>
                                @foreach (var item in Model.VaildEexCodeList)
                                {
                                    <li>
                                        <input type="checkbox" value="@item.exid" name="excodeid" />&nbsp;&nbsp;
                                @item.exsn &nbsp;&nbsp;&nbsp;&nbsp;
                                
                                有效期：@item.validtime.ToString("yyyy-MM-dd HH:mm")
                                    </li>
                                }
                            </ul>
                            @*<p>
                        输入10位兑换码：<input type="text" class="exchangecode text" name="exchangecode" value="" /></p>*@
                        </div>
                    </div>
                    <script type="text/javascript">
                        function openCoupon(obj) {
                            if (obj.className == "down") {
                                obj.className = "";
                                document.getElementById("excouponBlock").style.display = "none";
                            }
                            else {
                                obj.className = "down";
                                document.getElementById("excouponBlock").style.display = "block";
                                getValidCouponList();
                            }
                        }
                    </script>
                </div>
            }
            @{List<int> otherSelectPids = new List<int>() { 3757, 3756, 3755, 3730, 3729, 3728 };}
            @if (Model.AllSelectOrderProductList.Exists(x => otherSelectPids.Exists(p => p == x.Pid)))
            { 
                <div class="itme">
                    <h3><a href="javascript:;" class="down">选择城市</a></h3>
                    <div class="" id="exselectBlock">
                        <div class="itmeCon" id="">
                            <ul>
                                <li>
                                    <input type="radio" value="天津" name="exselectname" />天津
                                <input type="radio" value="郸城" name="exselectname" />郸城
                                <input type="radio" value="长春" name="exselectname" />长春
                                <input type="radio" value="襄县" name="exselectname" />襄县
                                <input type="radio" value="西安" name="exselectname" />西安
                                <input type="radio" value="平凉" name="exselectname" />平凉
                                <input type="radio" value="成都" name="exselectname" />成都
                                <input type="radio" value="上海" name="exselectname" />上海
                                <input type="radio" value="杭州" name="exselectname" />杭州
                                <input type="radio" value="靖江" name="exselectname" />靖江
                                <input type="radio" value="江阴" name="exselectname" />江阴
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            }
            @{List<int> otherSelectPids2 = new List<int>() { 3745, 3744 };}
            @if (Model.AllSelectOrderProductList.Exists(x => otherSelectPids2.Exists(p => p == x.Pid)))
            { 
                <div class="itme">
                    <h3><a href="javascript:;" class="down">选择书籍种类</a></h3>
                    <div class="" id="exselectBlock">
                        <div class="itmeCon" id="">
                            <ul>
                                <li>
                                    <input type="radio" value="文艺" name="exselectname" />文艺
                                <input type="radio" value="人文社科" name="exselectname" />人文社科
                                <input type="radio" value="童书" name="exselectname" />童书
                                <input type="radio" value="经管" name="exselectname" />经管
                                <input type="radio" value="励志" name="exselectname" />励志
                                <input type="radio" value="教育" name="exselectname" />教育
                                <input type="radio" value="科技" name="exselectname" />科技
                                <input type="radio" value="生活" name="exselectname" />生活
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            }
            @{List<int> otherSelectPids3 = new List<int>() { 3754, 3753 };}
            @if (Model.AllSelectOrderProductList.Exists(x => otherSelectPids3.Exists(p => p == x.Pid)))
            { 
                <div class="itme">
                    <h3><a href="javascript:;" class="down">选择类型</a></h3>
                    <div class="" id="exselectBlock">
                        <div class="itmeCon" id="">
                            <ul>
                                <li>
                                    <input type="radio" value="红酒赋颜菁华面膜贴" name="exselectname" />红酒赋颜菁华面膜贴
                                <input type="radio" value="胶原蛋白养护面膜贴" name="exselectname" />胶原蛋白养护面膜贴
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            }
            @if (StringHelper.ArrayContainsForNum(WebSiteConfig.QuanQiuGouStoreId, Model.SelectedStoreKeyList))
            { 
                <div class="itme">
                    <p>
                        <strong style="padding-right: 10px; color: #005ea7;">选择输入身份证 <span style="color: #ff6a00;">根据</span><a href="http://www.gov.cn/gongbao/content/2007/content_588177.htm" target="_blank" style="cursor: pointer; color: #000;">【海关总署令147号第二十二条】</a> 规定，个人海外购必须提供身份证进行入关申报，<span style="color: #ff6a00; font-weight: bold;">身份证号必须与收货人一致</span>，否则无法通关。</strong>
                    </p>
                    <div style="margin-top: 5px;">
                        <div>
                            <input type="hidden" name="isuseridcard" id="isuseridcard" value="@(StringHelper.ArrayContainsForNum(WebSiteConfig.QuanQiuGouStoreId, Model.SelectedStoreKeyList) ? 1 : 0)" />
                            <input type="text" name="idcard" id="idcard" class="text" style="width: 500px; padding: 0 5px; height: 24px; line-height: 24px;" value="" maxlength="18" />
                            <label style="color: #ff6a00; font-weight: bold; font-size: 14px; position: relative; cursor: pointer;" id="alertInfo_box">
                                <i style="display: inline-block; width: 16px; height: 16px; color: #fff; background-color: #ff6a00; font-style: normal; text-align: center; border-radius: 18px; text-indent: 2px; margin: 0 6px; font-size: 13px; line-height: 16px;">？</i>为什么要身份证
                <span class="alertInfo" style="position: absolute; width: 203px; padding: 20px 10px 0px; color: rgb(27, 27, 27); font-size: 12px; height: 95px; left: 0px; top: 15px; display: none; background: url(http://www.shopun.com/skin/default/images/cart/alertInfo.png) 50% 50% no-repeat; z-index: 99;">身份证信息仅在海关清关环节作为个人物品入境必须的凭证。按照国家隐私法规定，闪店跨境确保您的个人隐私权利不受侵犯。</span>
                            </label>

                        </div>
                    </div>
                </div>
            }


        </div>

        @if (Model.IsVerifyCode)
        { 
            <div style="float: right; margin-top: 14px;">
                <input type="text" name="verifyCode" id="verifyCode" autocomplete="off" style="padding: 6px 0px;" />
            </div>
            <div style="float: right; margin-top: 18px;">
                <img id="verifyImage" style="cursor: hand;" height="24" title="点击刷新验证码" onclick="this.src='/tool/verifyimage?time=' + new Date()" src="/tool/verifyimage" />
            </div>
        }
        <input type="hidden" id="fullCut" value="@Model.AllFullCut" />
        <form action="@Url.Action("confirmorder")" method="post" id="confirmOrderForm">
            <input type="hidden" id="selectedCartItemKeyList" name="selectedCartItemKeyList" value="@Model.SelectedCartItemKeyList" />
            <input type="hidden" id="selectedStoreKeyList" name="selectedStoreKeyList" value="@Model.SelectedStoreKeyList" />
            @if (Model.DefaultFullShipAddressInfo != null)
            {
                <input type="hidden" value="@Model.DefaultFullShipAddressInfo.SAId" name="saId" id="saId" />
            }
            else
            { 
                <input type="hidden" value="0" name="saId" id="saId" />
            }
            @if (Model.DefaultPayPluginInfo != null)
            {
                <input type="hidden" value="@Model.DefaultPayPluginInfo.SystemName" name="payName" id="payName" />
            }
            else
            {
                <input type="hidden" value="" name="payName" id="payName" />
            }
            <input type="hidden" value="@(Model.SelectCashPay ? 1 : 0)" name="selectCashPay" id="selectCashPay" />
        </form>
        <div class="orderSumBt borDDD" style="border-top: 0px;">
            <div class="orderSum">
                <ul>
                    <li><em>@Model.AllTotalCount 件商品，总商品金额：</em><b>¥@Model.AllProductAmount</b></li>
                    <li><em>运费：</em><b>¥@Model.AllShipFee.ToString("0.00")</b></li>
                    @*<li><em>税率：</em><b>¥@Model.PayFee</b></li>*@

                    @*<li><em>关税金额：</em><b>¥@(Model.TaxFee > 0 ? (Model.TaxFee.ToString("0.00") + (Model.TaxFee > 50 ? "" : "（免税）")) : "0.00")</b></li>*@
                    <li><em>红包减免：</em><b id="hongbaocut">-¥@(userHongBao2 > Model.AllHonBaoCutFee ? Model.AllHonBaoCutFee : userHongBao2)</b></li>
                    @if (Model.AllFullCut > 0)
                    {
                        <li><em>满减：</em><b id="diccount">¥-@Model.AllFullCut.ToString("0.00")</b></li>
                    }
                    <li><em>@(MallKey.MallDiscountName_JiangJin)抵现：</em><b id="savemoney">-0.00</b></li>
                    <li><em>代理账户抵现：</em><b id="agentCut">-0.00</b></li>
                    <li><em>佣金账户抵现：</em><b id="commisionCut">-0.00</b></li>
                    <li><em>优惠券：</em><b id="couponmoney">-0.00</b></li>
                    <li><em>汇购卡券：</em><b id="cashmoney">¥-0.00</b></li>
                    <li><em>付款总额：</em><b id="totalmoney">¥@(Model.AllOrderAmount - (userHongBao2 > Model.AllHonBaoCutFee ? Model.AllHonBaoCutFee : userHongBao2))</b></li>

                </ul>
                <span style="margin-left: 594px; line-height: 45px; font-size: 14px; color: #808080; display: inline-block; float: right;">（*本商城所有活动产品概不退换货哦）</span>
                @if (StringHelper.ArrayContainsForNum(WebHelper.GetConfigSettingsInt("AgentStoreId") + "," + WebHelper.GetConfigSettingsInt("AgentSuitStoreId"), Model.SelectedStoreKeyList))
                { 
                    <div style="margin-left: 594px; line-height: 45px; font-size: 14px; color: #808080; display: inline-block; float: right;">
                        <input type="checkbox" name="agreen" checked="" class="agreesign" />阅读并同意
                    <a href="javascript:;" id="usesigning" class="usesigning" onclick="usesign();">《代理用户电子签约协议》</a>

                    </div>
                }
                <div class="clear"></div>
            </div>
            <div class="orderSumRight">

                <a href="javascript:submitOrder()" class="addOrderBtn redOrderBt " id="addorder">提交订单</a>

            </div>

        </div>
    </div>

    <div class="protocol" id="usesigningDiv" style="display: none;">
        <div class="protocol-con">
            <h4>代理协议</h4>

            <p><strong>12.3</strong><span>本协议内容中以黑体、加粗、下划线、斜体等方式显著标识的条款，请用户着重阅读。</span></p>

            <p>
                <strong>12.4</strong><span>您点击本协议下方的;同意并继续;按钮即视为您完全接受本协议，在点击之前请您再次确认已知悉并完全理解本协议的全部内容。</span>
            </p>

        </div>
        <div class="protocol-button">
            <button onclick="closeusesign()">同意并继续</button>
        </div>
    </div>


    @*<div id="footer" class="bigBox">*@
    @Html.Partial("/views/publicpage/footernobar2016.cshtml")
    @*
    </div>*@
    <script type="text/javascript">
        //绑定省列表的改变事件
        Event.addHandler(document.getElementById("provinceId"), "change", function (event) {
            var selectedProvinceId = getSelectedOption(this).value;
            if (selectedProvinceId > 0) {
                document.getElementById("regionId").innerHTML = "<option value='-1'>请选择</option>";
                bindCityList(selectedProvinceId, document.getElementById("cityId"));
            }
        })


        //绑定市列表的改变事件
        Event.addHandler(document.getElementById("cityId"), "change", function (event) {
            var selectedCityId = getSelectedOption(this).value;
            if (selectedCityId > 0) {
                bindCityList(selectedCityId, document.getElementById("regionId"));
            }
        })

        //绑定省列表
        bindProvinceList(document.getElementById("provinceId"), provinceId);

        if (cityId > 0) {
            bindCityList(provinceId, document.getElementById("cityId"), cityId);
            bindCountyList(cityId, document.getElementById("regionId"), countyId);
        }
    </script>
    @*@Html.Raw(WorkContext.ExecuteDetail)
@Html.Raw(WorkContext.MallConfig.Script)*@
</body>
</html>

